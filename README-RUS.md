Авторы Елизавета Ежова и Гавриков Александр.
# Установка

```bash
git clone https://github.com/alexavr/EddyClicker.git
cd EddyClicker
conda env create --file environment.yml
conda activate clicker_env
python eddyclicker.py
```

Если требуется **переустановить** пакет, то нужно: 
1. Скопировать папку со сделанными треками `TRACKS_FOLDER`, (см. ниже раздел "Конфигурация"). Если в ней есть что-то ценное.   
2. Удалить окружение: `conda remove -n clicker_env --all`.
3. После этого начать установку с нуля.
# Подготовка 

1. Скопировать в папку `EddyClicker` данные по которым планируете трекать. Формат данных описан в `README.md` на [github](https://github.com/alexavr/EddyClicker.git) репозитории.
2. ... или воспользоваться тестовым файлом `TEST.nc`
3. Выяснить в этих данных как называются переменные для полей *рортекс*, *геопотенциала*, *центров вихрей* и *топографии* (это необходимые поля). Если требуются дополнительные поля для уточнения границ вихря, то можно добавить еще до двух параметров, например скорость ветра и облачное покрытие -- тогда нужно выяснить названия и этих переменных тоже.  В приложении будет возможность переключаться между этими полями в любой момент (см. раздел "Процедура трекинга").

# Конфигурация
Конфигурация происходит в файле `const.py`.  Где переменные `SCREEN_HEIGHT` и `WINDOW_WIDTH` отвечают за размер GUI окна (в зависимости от форма поля бывает полезно это изменить). `FILE_RORTEX` -- имя входного файла. `TRACKS_FOLDER` -- наименование папки, в которую будут записываться треки. Если входящие переменные, помимо горизонтальных, имеют вертикальное измерение, то необходимо переменной  `LEVEL` присвоить значение интересующего уровня по высоте. Имена обязательных переменных рортекса, поля с центрами структур, геопотенциала и топографии в исходном файле `FILE_RORTEX`:  `RORTEX_VARNAME`, `LOCAL_EXTR_VARNAME`, `GEOPOTENTIAL_VARNAME` и `HGT_VARNAME`.  Массив `SCALARS` описывает переменные, которые нужно отобразить помимо рортекса: переменная  `GEOPOTENTIAL_VARNAME` обязательная и должна присутствовать в любом случае. Остальные переменные (в тестовом файл это поле облачности и скорости ветра) -- вспомогательные и служат для помощи в определении границ вихря и переключение между ними осуществляется клавишами `q`, `w` и `e`. Обратите внимание, что раскладка клавиатуры должна быть английской. 

Ниже представлен пример конфигурационного файла, та его часть, которая обычно требует изменения. Остальное можно трогать только если вы точно знаете что делаете!):
```python
###############################################################################
### CHANGE THIS START #########################################################

# GUI WINDOWS SIZE
SCREEN_HEIGHT = 850
WINDOW_WIDTH = 1500

# INPUT AND OUTPUT FILE 
FILE_RORTEX = "TEST.nc"  
TRACKS_FOLDER = "track_folder"  # track output folder

# REQUIRED VARIABLES
LEVEL = 0  									# Level of interest
RORTEX_VARNAME = "R2D" 						# Rortex variable to plot
LOCAL_EXTR_VARNAME = "local_extr_cluster"  	# dots to plot (scatter)
GEOPOTENTIAL_VARNAME = "geopotential"  		# contour to plot above Rortex field
HGT_VARNAME = "HGT" 						# coastline plot (2D curve)

# OTHER VARIABLES (vars to help recognize vortices)
SCALARS = [
{"name":GEOPOTENTIAL_VARNAME, "fill": False, "step": 50, "cmap": ""},# REQUIRED, Key Q
{"name":"cloudfrac", "fill": True , "step": 0.01, "cmap": "binary_r"},# Optional, Key W
{"name":"WSPD", "fill": True , "step": 1, "cmap": "viridis" },   # Optional, Key E
]

### CHANGE THIS END   #########################################################
###############################################################################
```
# Процедура трекинга

Программа запускается командой 
```bash
python eddyclicker.py
```
Вам откроется окно, где черной кривой показана береговая линия, цветом нанесено значение поля рортекса, изолиниями -- поле геопотенциала, а полые кружки -- центры вихрей. На первом шаге по времени вы ничего сделать не сможете и нужно нажать `->`, чтобы перейти на следующий момент по времени. Теперь появятся черные точки -- это центры вихрей на предыдущем шаге по времени. Нужно левой кнопкой мыши (ЛКП) кликнуть на черную точку и затем на полый кружок -- это будет первый сегмент траектории. Далее определяем размер вихря, для этого нужно обозначить эллипс в который будет помещаться вихрь. Первые два клика ЛКМ обозначают главную (самую длинную) ось эллипса. Следующий (один) клик -- короткую ось. После этого отобразится синий эллипс, в который вписан ваш вихрь. Допускается увеличивать или двигать изображение системными кнопками *matplotlib*.

![Window screenshot](./1.png)

**ВАЖНО: АЛГОРТИМ ПРОГРАММЫ ПОЗВОЛЯЕТ ТРЕКАТЬ ТОЛЬКО ОДИН ВИХРЬ ЗА РАЗ!** 

Навигация между шагами по времени осуществляется стрелками `->` и `<-`.

После того, как трек был построен (вихрь закончил свою жизнь), нажимаем правой кнопкой мыши (ПКМ) и отвечаем "Yes" на вопрос о сохранении файла. И переходим к следующему вихрю. 

# Советы

1.  Лучше пусть эллипс будет больше вихря, чем меньше его.
2. Если вихрь вписался в эллипс не так, как вы хотели -- нажмите `cntr+z`, чтобы отменить свои действия.
3. В случае, если весь трек вызывает подозрения, можно закончить его раньше времени: жмем ПКМ и во всплывающем окне ответить "No" на вопрос о сохранении. 
4. Вы всегда можете вернуться на предыдущий или далее шаг по времени.
